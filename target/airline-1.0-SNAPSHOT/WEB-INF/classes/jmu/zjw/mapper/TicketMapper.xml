<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="jmu.zjw.mapper.TicketMapper">
    <insert id="insertTicket">
        insert into Ticket(tprice,tTime,tFood,tCity1,tCity2,ofId,sId,cabinId)
        values(#{ticket.tprice},#{ticket.tTime},#{ticket.tFood},#{ticket.tCity1},#{ticket.tCity2},#{ticket.ofId},#{ticket.sId},#{ticket.cabinId});
        insert into mOrder(oprice,phone,oId,otime,crId)
        values(#{order.oprice},#{order.phone},#{order.oId},#{order.otime},#{order.crId});
    </insert>

    <update id="updateTicket">
        update Ticket set tTime = (select ofAirTime from onFlight where ofId = #{ofId}) where tId = (select tId from (select tId from Ticket where sId = #{ticket.sId}) as ta);
        update mOrder set tId = (select tId from Ticket where sId = #{ticket.sId}) where oId = (select tId from Ticket where sId = #{ticket.sId});
        update Seat set status = false where sId = #{ticket.sId};
        update Cabin set RemainTicket = RemainTicket - 1 where cabinId = #{ticket.cabinId};
    </update>

    <select id="findTicketById" parameterType="String" resultType="jmu.zjw.po.Ticket">
        select * from Ticket where tId in (select tId from mOrder where crId = #{crId})
    </select>

    <select id="findTicketBytId" parameterType="String" resultType="jmu.zjw.po.Ticket">
        select * from Ticket where tId = #{tId}
    </select>
    <delete id="deleteTicket" parameterType="int">
        delete from Ticket where tId = #{tId}
    </delete>
    <update id="updateTicket2" parameterType="jmu.zjw.po.Ticket">
        update Seat set status = true where sId = #{sId};
        update Cabin set RemainTicket = RemainTicket + 1 where cabinId = #{cabinId};
    </update>
</mapper>
